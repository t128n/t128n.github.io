---
import { getCollection } from "astro:content";
import BlogPosts from "@/components/blog-posts.astro";
import RootLayout from "@/layouts/root-layout.astro";

// Get all published blog posts
const posts = await getCollection("blog", ({ data }) => !data.draft);

// Sort by publish date
posts.sort((a, b) => {
  return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime();
});

// Get unique tags for filtering
const allTags = [...new Set(posts.flatMap(post => post.data.tags || []))].sort();
---

<RootLayout title="Blog" description="Technical articles, tutorials, and insights on software engineering, development practices, and technology.">
  <main>
    <header>
      <h1>Blog</h1>
      <p>Technical articles, tutorials, and insights on software engineering, development practices, and technology.</p>
    </header>
    
    {allTags.length > 0 && (
      <section class="tags" aria-labelledby="tags-heading">
        <h2 id="tags-heading">Topics</h2>
        <div class="tag-list">
          {allTags.map(tag => (
            <span class="tag">#{tag}</span>
          ))}
        </div>
      </section>
    )}
    
    <section aria-labelledby="posts-heading">
      <h2 id="posts-heading" class="sr-only">All Blog Posts</h2>
      <BlogPosts />
    </section>
  </main>
</RootLayout>

<style>
  main {
    display: flex;
    flex-direction: column;
    gap: var(--space-8);
  }

  header {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  header h1 {
    font-size: var(--text-xl);
    font-weight: 500;
    margin: 0;
    font-family: var(--font-sans);
  }

  header p {
    color: var(--color-text-secondary);
    margin: 0;
    line-height: var(--line-height-relaxed);
    font-family: var(--font-sans);
  }

  .tags {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .tags h2 {
    font-size: var(--text-base);
    font-weight: 500;
    margin: 0;
    font-family: var(--font-sans);
  }

  .tag-list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .tag {
    font-size: var(--text-sm);
    color: var(--color-text-secondary);
    font-family: var(--font-mono);
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
</style>