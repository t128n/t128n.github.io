---
import { getCollection } from "astro:content";
import title from "@/lib/title";

interface BlogPostsProps {
  /**
   * Show draft posts (default: false)
   */
  showDrafts?: boolean;
}

const { showDrafts = false } = Astro.props as BlogPostsProps;

const posts = await getCollection(
  "blog",
  ({ data }) => showDrafts || !data.draft,
);

posts.sort((a, b) => {
  return (
    new Date(b.data.publishDate).getTime() -
    new Date(a.data.publishDate).getTime()
  );
});
---

<section>
  {
    posts.map((post) => (
      <article>
        <header>
          <time datetime={post.data.publishDate.toISOString()}>
            {post.data.publishDate.toISOString().split("T")[0]}
          </time>
          <div>
            <a href={`/blog/${post.data.slug}`}>
              {title(post.data.title)}
            </a>
            <p>{post.data.description}</p>
          </div>
        </header>
      </article>
    ))
  }
</section>

<style>
  section {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  article {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }
  
  article header {
    display: flex;
    gap: var(--space-4);
    align-items: baseline;
  }
  
  article header time {
    color: var(--color-text-secondary);
    font-size: var(--text-sm);
    white-space: nowrap;
    min-width: 5ch;
    flex-shrink: 0;
  }
  
  article header div {
    display: flex;
    flex-direction: column;
    gap: var(--space-1);
    flex: 1;
  }
  
  article header a {
    text-decoration: none;
    color: var(--color-text);
    font-weight: 500;
    font-family: var(--font-sans);
  }
  
  article header a:hover {
    color: var(--color-accent);
    text-decoration: underline;
  }
  
  article p {
    color: var(--color-text-secondary);
    line-height: var(--line-height-relaxed);
    margin: 0;
    font-family: var(--font-sans);
  }
  
  @media (max-width: 640px) {
    article header {
      flex-direction: column;
      gap: var(--space-1);
      align-items: flex-start;
    }
    
    article header time {
      min-width: auto;
    }
  }
</style>
